<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
	<link rel="stylesheet" href="styles.css">
	<title>PMD Text Line Test</title>
	
	<link rel="icon" 
      type="image/png" 
      href="assets/favicon.png" />
	  
	<meta charset="utf-8"/>
	<meta name="description" content="Test Lines of text"/>
	<meta name="author" content="u/TheDasK" />
	<meta name="robots" content="index,nofollow" />
	  
</head>
<body>
	<h1>ExplorerScript Boundary Test</h1>
	<div class="section-input">
		<textarea rows="4" cols="56" id="input" onkeyup="inputChange()"></textarea>
	</div>
	<div class="section-result ">
		<canvas width="480" height="88" id="box"></canvas>
		<p id="output"></p>
	</div>
	<div class="wsStatus" hidden>
		<img src="assets/skytemple.png"><p id="wsText">Connecting</p>
	</div>
	<div class="section-text">
		<p hidden>Scale: <a onclick="scaleChange(1)">1x</a> <a onclick="scaleChange(2)">2x</a> <a onclick="scaleChange(3)">3x</a> <a onclick="scaleChange(4)">4x</a> </p>
		<p>Speaker: <a onclick="speakerChange('hero')">Hero</a> <a onclick="speakerChange('partner')">Partner</a> <a onclick="speakerChange('icon')">Icon</a> <a onclick="speakerChange('')">None</a></p>
		<p>Welcome to the Explorerscript Boundary Test! The idea of the site is to test if lines of text written in ExplorerScript fits in a the game's text box.<br>
			All characters should have the right size, but let me know if I messed up any symbol! The textbox is multi-line so you can check as many lines as you want.<br>
			These special symbols are supported, with some modifications:
		   <ul class="social-media">
			<li>\n - New Line</li>
			<li>\' - '</li>
			<li>\" - "</li>
		</ul>
		</p>
		<div class="tables">
			<table class="tagtables">
				<thead>
					<tr><th colspan="3" onclick="toogleTable(this)">Show Icon Tags</th></tr>
				</thead>
				<tbody hidden>
					<tr><td>Tag</td><td>Icon</td><td>Description</td></tr>
					<tr><td>[M:B0]</td><td><img src="assets/icons.png" class="icon-controls1"></td><td>Start</td></tr>
					<tr><td>[M:B1]</td><td><img src="assets/icons.png" class="icon-controls2"></td><td>Select</td></tr>
					<tr><td>[M:B2]</td><td><img src="assets/icons.png" class="icon-controls3"></td><td>A</td></tr>
					<tr><td>[M:B3]</td><td><img src="assets/icons.png" class="icon-controls4"></td><td>B</td></tr>
					<tr><td>[M:B4]</td><td><img src="assets/icons.png" class="icon-controls5"></td><td>X</td></tr>
					<tr><td>[M:B5]</td><td><img src="assets/icons.png" class="icon-controls6"></td><td>Y</td></tr>
					<tr><td>[M:B6]</td><td><img src="assets/icons.png" class="icon-controls7"></td><td>L</td></tr>
					<tr><td>[M:B7]</td><td><img src="assets/icons.png" class="icon-controls8"></td><td>R</td></tr>
					<tr><td>[M:B8]</td><td><img src="assets/icons.png" class="icon-controls9"></td><td>D-Pad</td></tr>
					<tr><td>[M:B9]</td><td><img src="assets/icons.png" class="icon-block1"></td><td>- Block</td></tr>
					<tr><td>[M:B10]</td><td><img src="assets/icons.png" class="icon-block2"></td><td>Check Block</td></tr>
					<tr><td>[M:B11]</td><td><img src="assets/icons.png" class="icon-block3"></td><td>X Block</td></tr>
					<tr><td>[M:B12]</td><td><img src="assets/icons.png" class="icon-block4"></td><td>Up Block</td></tr>
					<tr><td>[M:B13]</td><td><img src="assets/icons.png" class="icon-block5"></td><td>Down Block</td></tr>
					<tr><td>[M:B14]</td><td><img src="assets/icons.png" class="icon-block6"></td><td>Left Block</td></tr>
					<tr><td>[M:B15]</td><td><img src="assets/icons.png" class="icon-block7"></td><td>Right Block</td></tr>
					<tr><td>[M:B16]</td><td><img src="assets/icons.png" class="icon-block8"></td><td>Rewind Block</td></tr>
					<tr><td>[M:B17]</td><td><img src="assets/icons.png" class="icon-block9"></td><td>FF Block</td></tr>
					<tr><td>[M:B18]</td><td><img src="assets/icons.png" class="icon-block10"></td><td>Sort Block</td></tr>
					<tr><td>[M:B19]</td><td><img src="assets/icons.png" class="icon-block11"></td><td>Search Block</td></tr>
					<tr><td>[M:B20]</td><td><img src="assets/icons.png" class="icon-block12"></td><td>D-Pad U-D Block</td></tr>
					<tr><td>[M:B21]</td><td><img src="assets/icons.png" class="icon-block13"></td><td>D-Pad L-R Block</td></tr>
					<tr><td>[M:B22]</td><td><img src="assets/icons.png" class="icon-gblock1"></td><td>- Gold Block</td></tr>
					<tr><td>[M:B23]</td><td><img src="assets/icons.png" class="icon-gblock2"></td><td>Check Gold Block</td></tr>
					<tr><td>[M:B24]</td><td><img src="assets/icons.png" class="icon-gblock3"></td><td>X Gold Block</td></tr>
					<tr><td>[M:B25]</td><td><img src="assets/icons.png" class="icon-gblock4"></td><td>Up Gold Block</td></tr>
					<tr><td>[M:B26]</td><td><img src="assets/icons.png" class="icon-gblock5"></td><td>Down Gold Block</td></tr>
					<tr><td>[M:B27]</td><td><img src="assets/icons.png" class="icon-gblock6"></td><td>Left Gold Block</td></tr>
					<tr><td>[M:B28]</td><td><img src="assets/icons.png" class="icon-gblock7"></td><td>Right Gold Block</td></tr>
					<tr><td>[M:B29]</td><td><img src="assets/icons.png" class="icon-gblock8"></td><td>Rewind Gold Block</td></tr>
					<tr><td>[M:B30]</td><td><img src="assets/icons.png" class="icon-gblock11"></td><td>FF Gold Block</td></tr>
					<tr><td>[M:B31]</td><td><img src="assets/icons.png" class="icon-gblock12"></td><td>Sort Gold Block</td></tr>
					<tr><td>[M:B32]</td><td><img src="assets/icons.png" class="icon-gblock13"></td><td>Search Gold Block</td></tr>
					<tr><td>[M:S0]</td><td><img src="assets/icons.png" class="icon-pmoney"></td><td>P-Money</td></tr>
					<tr><td>[M:S1]</td><td> </td><td>Space</td></tr>
					<tr><td>[M:S2]</td><td><img src="assets/icons.png" class="icon-check1"></td><td>Check</td></tr>
					<tr><td>[M:S3]</td><td><img src="assets/icons.png" class="icon-star1"></td><td>Star</td></tr>
					<tr><td>[M:S4]</td><td><img src="assets/icons.png" class="icon-check2"></td><td>X</td></tr>
					<tr><td>[M:S5]</td><td><img src="assets/icons.png" class="icon-check3"></td><td>Check X</td></tr>
					<tr><td>[M:B39]</td><td><img src="assets/icons.png" class="icon-bag"></td><td>Bag</td></tr>
					<tr><td>[M:B40]</td><td><img src="assets/icons.png" class="icon-hut"></td><td>Hut</td></tr>
					<tr><td>[M:H0]</td><td><img src="assets/icons.png" class="icon-heart1"></td><td>Heart pink vsmall</td></tr>
					<tr><td>[M:H1]</td><td><img src="assets/icons.png" class="icon-heart2"></td><td>Heart pink small</td></tr>
					<tr><td>[M:H2]</td><td><img src="assets/icons.png" class="icon-heart3"></td><td>Heart pink</td></tr>
					<tr><td>[M:H3]</td><td><img src="assets/icons.png" class="icon-heart4"></td><td>Heart pink big</td></tr>
					<tr><td>[M:H4]</td><td><img src="assets/icons.png" class="icon-heart5"></td><td>Heart yellow vsmall</td></tr>
					<tr><td>[M:H5]</td><td><img src="assets/icons.png" class="icon-heart6"></td><td>Heart yellow small</td></tr>
					<tr><td>[M:H6]</td><td><img src="assets/icons.png" class="icon-heart7"></td><td>Heart yellow</td></tr>
					<tr><td>[M:H7]</td><td><img src="assets/icons.png" class="icon-heart8"></td><td>Heart yellow big</td></tr>
					<tr><td>[M:H8]</td><td><img src="assets/icons.png" class="icon-heart9"></td><td>Heart pink unshaded</td></tr>
					<tr><td>[M:R0]</td><td><img src="assets/icons.png" class="icon-dash"></td><td>Dash</td></tr>
					<tr><td>[M:R1]</td><td><img src="assets/icons.png" class="icon-star2"></td><td>Half Star</td></tr>
					<tr><td>[M:R2]</td><td><img src="assets/icons.png" class="icon-star3"></td><td>Amber Gem?</td></tr>
					<tr><td>[M:R3]</td><td><img src="assets/icons.png" class="icon-mail1"></td><td>Unopened Mail</td></tr>
					<tr><td>[M:R4]</td><td><img src="assets/icons.png" class="icon-mail2"></td><td>Open Mail</td></tr>
					<tr><td>[M:R5]</td><td><img src="assets/icons.png" class="icon-mail3"></td><td>Letter</td></tr>
					<tr><td>[M:R6]</td><td><img src="assets/icons.png" class="icon-mail4"></td><td>Newspaper</td></tr>
					<tr><td>[M:R7]</td><td><img src="assets/icons.png" class="icon-exclamation"></td><td>! Box</td></tr>
					<tr><td>[M:R8]</td><td><img src="assets/icons.png" class="icon-wifi"></td><td>Wi-Fi</td></tr>
					<tr><td>[M:R9]</td><td><img src="assets/icons.png" class="icon-email"></td><td>E-Mail</td></tr>
					<tr><td>[M:T0]</td><td>:</td><td>Colon</td></tr>
					<tr><td>[M:T1]</td><td> </td><td>Space</td></tr>
					<tr><td>[M:T2]</td><td><img src="assets/icons.png" class="icon-bubble"></td><td>Text Bubble</td></tr>
					<tr><td>[M:B62]</td><td><img src="assets/icons.png" class="icon-space1"></td><td>Space Indicator</td></tr>
					<tr><td>[M:B63]</td><td><img src="assets/icons.png" class="icon-space2"></td><td>Space Indicator Red</td></tr>
					<tr><td>[M:T2]</td><td><img src="assets/icons.png" class="icon-kanji1"></td><td>Kanji 1 ?</td></tr>
					<tr><td>[M:T3]</td><td><img src="assets/icons.png" class="icon-kanji2"></td><td>Kanji 2 ?</td></tr>
					<tr><td>[M:T4]</td><td><img src="assets/icons.png" class="icon-kanji3"></td><td>Kanji 3 ?</td></tr>
					<tr><td>[M:I0]</td><td><img src="assets/icons.png" class="icon-tm"></td><td>TM</td></tr>
					<tr><td>[M:I1]</td><td><img src="assets/icons.png" class="icon-orb"></td><td>Orb</td></tr>
				</tbody>
			</table>
			<table class="tagtables">
				<thead>
					<tr><th colspan="2" onclick="toogleTable(this)">Show Color Tags</th></tr>
				</thead>
				<tbody id="hiddable" hidden>
					<tr><td>Tag</td><td>Color</td></tr>
					<tr><td>[CS:A]</td><td><span class="color1">Cream</td></tr>
					<tr><td>[CS:B]</td><td><span class="color2">Red</td></tr>
					<tr><td>[CS:D]</td><td><span class="color4">White</td></tr>
					<tr><td>[CS:C]</td><td><span class="color3">Yellow</td></tr>
					<tr><td>[CS:D]</td><td><span class="color4">White</td></tr>
					<tr><td>[CS:G]</td><td><span class="color5">Cyan</td></tr>
					<tr><td>[CS:H]</td><td><span class="color6">Pink</td></tr>
					<tr><td>[CS:J]</td><td><span class="color8">Light Yellow</td></tr>
					<tr><td>[CS:K]</td><td><span class="color9">Light Green</td></tr>
					<tr><td>[CS:L]</td><td><span class="color10">Green</td></tr>
					<tr><td>[CS:O]</td><td><span class="color11">Dark Green</td></tr>
					<tr><td>[CS:P]</td><td><span class="color12">Dark Cream</td></tr>
					<tr><td>[CS:Q]</td><td><span class="color13">Blue</td></tr>
					<tr><td>[CS:R]</td><td><span class="color14">Pale Green</td></tr>
					<tr><td>[CS:S]</td><td><span class="color15">Purple</td></tr>
					<tr><td>[CS:T]</td><td><span class="color16">Transparent</td></tr>
					<tr><td>[CS:X]</td><td><span class="color17">Bright Pink</td></tr>
					<tr><td>[CS:Y]</td><td><span class="color18">Light Blue</td></tr>
					<tr><td>[CS:Z]</td><td><span class="color19">Light Purple</td></tr>
					<tr><td>[CR]</td><td><span class="color4">End Coloring</td></tr>
				</tbody>
			</table>
			<table class="tagtables">
				<thead>
					<tr><th colspan="2" onclick="toogleTable(this)">Show Other Tags</th></tr>
				</thead>
				<tbody hidden>
					<tr><td>Tag</td><td>Color</td></tr>
					<tr><td>[hero]</td><td>Player Name</td></tr>
					<tr><td>[partner]</td><td>Partner Name</td></tr>
					<tr><td>[team]</td><td>Team Name</td></tr>
					<tr><td>[FT:1]</td><td>Start Unown text, uses Caps</td></tr>
					<tr><td>[FT:0]</td><td>Stop Unown text</td></tr>
					<tr><td>[c_kind:PLAYER]</td><td>Player Species</td></tr>
					<tr><td>[c_kind:ATTENDANT1]</td><td>Partner Species</td></tr>
					<tr><td>[CN]</td><td>Center following text TODO</td></tr>
					<tr><td>[S:#]</td><td>Adds a space of # pixels TODO</td></tr>
					<tr><td>[BAR]</td><td>Horizontal Line TODO</td></tr>
					<tr><td colspan="2">Beyond Scope of this App:</td></tr>
					<tr><td>[K]</td><td>Waits for Player input</td></tr>
					<tr><td>[W:#]</td><td>Waits for # frames</td></tr>
					<tr><td>[C]</td><td>Pause at end</td></tr>
				</tbody>
			</table>
		</div>
		<p>Everything else in brackets gets ignored. If I missed some useful and common tag of symbol, or you want some other feature implemented,
		or just want to correct me on my grammar (please do), let me know, I'm DasK on <a href="https://discord.gg/4e3X36f">SkyTemple's Discord</a>!<br>
		</p>
		<p>
		Check the sourcecode <a href="https://github.com/theDasK/TextTest">here</a>. <a href="https://www.dafont.com/wonder-mail.font">Wonder Mail</a> font by <a href="https://www.reddit.com/user/ShinxHijinx">ShinxHijinx</a>
		</p>
	</div>


	<script>

		function drawBox(nlines){

			canvas.height = 44*scale;
			output.height = 34*scale+20;
			context.clearRect(0, 0, canvas.width, canvas.height);

			if (nlines < 3) {
				canvas.height = 44*scale;
				context.drawImage(boxtop,0,0,240*scale,9*scale);
				context.drawImage(boxmid,0,9*scale,240*scale,26*scale);
				context.drawImage(boxbot,0,35*scale,240*scale,9*scale);
			} else {
				canvas.height = (18+13*nlines)*scale;
				context.drawImage(boxtop,0,0*scale,240*scale,9*scale);
				context.drawImage(boxmid,0,9*scale,240*scale,26*nlines*scale);
				context.drawImage(boxbot,0,(9+13*nlines)*scale,240*scale,9*scale);
			}
		}

		const isUpperCase = (string) => /^[A-Z]*$/.test(string)

		function replaceAt(str, index, replacement) {
    		return str.substr(0, index) + replacement + str.substr(index + replacement.length);
		}

		function inputChange(){

			let tin = speaker + input.value;


			tin = tin
			.replaceAll('[M:B0]', '<img src="assets/icons.png" class="icon-controls1">')
			.replaceAll('[M:B1]', '<img src="assets/icons.png" class="icon-controls2">')
			.replaceAll('[M:B2]', '<img src="assets/icons.png" class="icon-controls3">')
			.replaceAll('[M:B3]', '<img src="assets/icons.png" class="icon-controls4">')
			.replaceAll('[M:B4]', '<img src="assets/icons.png" class="icon-controls5">')
			.replaceAll('[M:B5]', '<img src="assets/icons.png" class="icon-controls6">')
			.replaceAll('[M:B6]', '<img src="assets/icons.png" class="icon-controls7">')
			.replaceAll('[M:B7]', '<img src="assets/icons.png" class="icon-controls8">')
			.replaceAll('[M:B8]', '<img src="assets/icons.png" class="icon-controls9">')
			.replaceAll('[M:B9]', '<img src="assets/icons.png" class="icon-block1">')
			.replaceAll('[M:B10]', '<img src="assets/icons.png" class="icon-block2">')
			.replaceAll('[M:B11]', '<img src="assets/icons.png" class="icon-block3">')
			.replaceAll('[M:B12]', '<img src="assets/icons.png" class="icon-block4">')
			.replaceAll('[M:B13]', '<img src="assets/icons.png" class="icon-block5">')
			.replaceAll('[M:B14]', '<img src="assets/icons.png" class="icon-block6">')
			.replaceAll('[M:B15]', '<img src="assets/icons.png" class="icon-block7">')
			.replaceAll('[M:B16]', '<img src="assets/icons.png" class="icon-block8">')
			.replaceAll('[M:B17]', '<img src="assets/icons.png" class="icon-block9">')
			.replaceAll('[M:B18]', '<img src="assets/icons.png" class="icon-block10">')
			.replaceAll('[M:B19]', '<img src="assets/icons.png" class="icon-block11">')
			.replaceAll('[M:B20]', '<img src="assets/icons.png" class="icon-block12">')
			.replaceAll('[M:B21]', '<img src="assets/icons.png" class="icon-block13">')
			.replaceAll('[M:B22]', '<img src="assets/icons.png" class="icon-gblock1">')
			.replaceAll('[M:B23]', '<img src="assets/icons.png" class="icon-gblock2">')
			.replaceAll('[M:B24]', '<img src="assets/icons.png" class="icon-gblock3">')
			.replaceAll('[M:B25]', '<img src="assets/icons.png" class="icon-gblock4">')
			.replaceAll('[M:B26]', '<img src="assets/icons.png" class="icon-gblock5">')
			.replaceAll('[M:B27]', '<img src="assets/icons.png" class="icon-gblock6">')
			.replaceAll('[M:B28]', '<img src="assets/icons.png" class="icon-gblock7">')
			.replaceAll('[M:B29]', '<img src="assets/icons.png" class="icon-gblock8">')
			.replaceAll('[M:B30]', '<img src="assets/icons.png" class="icon-gblock11">')
			.replaceAll('[M:B31]', '<img src="assets/icons.png" class="icon-gblock12">')
			.replaceAll('[M:B31]', '<img src="assets/icons.png" class="icon-gblock13">')
			.replaceAll('[M:B33]', '<img src="assets/icons.png" class="icon-pmoney">')
			.replaceAll('[M:B34]', ' ')
			.replaceAll('[M:B35]', '<img src="assets/icons.png" class="icon-check1">')
			.replaceAll('[M:B36]', '<img src="assets/icons.png" class="icon-star1">')
			.replaceAll('[M:B37]', '<img src="assets/icons.png" class="icon-check2">')
			.replaceAll('[M:B38]', '<img src="assets/icons.png" class="icon-check3">')
			.replaceAll('[M:B39]', '<img src="assets/icons.png" class="icon-bag">')
			.replaceAll('[M:B40]', '<img src="assets/icons.png" class="icon-hut">')
			.replaceAll('[M:B41]', '<img src="assets/icons.png" class="icon-heart1">')
			.replaceAll('[M:B42]', '<img src="assets/icons.png" class="icon-heart2">')
			.replaceAll('[M:B43]', '<img src="assets/icons.png" class="icon-heart3">')
			.replaceAll('[M:B44]', '<img src="assets/icons.png" class="icon-heart4">')
			.replaceAll('[M:B45]', '<img src="assets/icons.png" class="icon-heart5">')
			.replaceAll('[M:B46]', '<img src="assets/icons.png" class="icon-heart6">')
			.replaceAll('[M:B47]', '<img src="assets/icons.png" class="icon-heart7">')
			.replaceAll('[M:B48]', '<img src="assets/icons.png" class="icon-heart8">')
			.replaceAll('[M:B49]', '<img src="assets/icons.png" class="icon-heart9">')
			.replaceAll('[M:B50]', '<img src="assets/icons.png" class="icon-dash">')
			.replaceAll('[M:B51]', '<img src="assets/icons.png" class="icon-star2">')
			.replaceAll('[M:B52]', '<img src="assets/icons.png" class="icon-star3">')
			.replaceAll('[M:B53]', '<img src="assets/icons.png" class="icon-mail1">')
			.replaceAll('[M:B54]', '<img src="assets/icons.png" class="icon-mail2">')
			.replaceAll('[M:B55]', '<img src="assets/icons.png" class="icon-mail3">')
			.replaceAll('[M:B56]', '<img src="assets/icons.png" class="icon-mail4">')
			.replaceAll('[M:B57]', '<img src="assets/icons.png" class="icon-exclamation">')
			.replaceAll('[M:B58]', '<img src="assets/icons.png" class="icon-wifi">')
			.replaceAll('[M:B59]', '<img src="assets/icons.png" class="icon-email">')
			.replaceAll('[M:B60]', ':')
			.replaceAll('[M:B61]', '<img src="assets/icons.png" class="icon-bubble">')
			.replaceAll('[M:B62]', '<img src="assets/icons.png" class="icon-space1">')
			.replaceAll('[M:B63]', '<img src="assets/icons.png" class="icon-space2">')
			.replaceAll('[M:B64]', '<img src="assets/icons.png" class="icon-kanji1">')
			.replaceAll('[M:B65]', '<img src="assets/icons.png" class="icon-kanji2">')
			.replaceAll('[M:B66]', '<img src="assets/icons.png" class="icon-kanji3">')
			.replaceAll('[M:B67]', '<img src="assets/icons.png" class="icon-tm">')
			.replaceAll('[M:B68]', '<img src="assets/icons.png" class="icon-orb">')

			.replaceAll('[M:S0]', '<img src="assets/icons.png" class="icon-pmoney">')
			.replaceAll('[M:S1]', ' ')
			.replaceAll('[M:S2]', '<img src="assets/icons.png" class="icon-check1">')
			.replaceAll('[M:S3]', '<img src="assets/icons.png" class="icon-star1">')
			.replaceAll('[M:S4]', '<img src="assets/icons.png" class="icon-check2">')
			.replaceAll('[M:S5]', '<img src="assets/icons.png" class="icon-check3">')
			.replaceAll('[M:H0]', '<img src="assets/icons.png" class="icon-heart1">')
			.replaceAll('[M:H1]', '<img src="assets/icons.png" class="icon-heart2">')
			.replaceAll('[M:H2]', '<img src="assets/icons.png" class="icon-heart3">')
			.replaceAll('[M:H3]', '<img src="assets/icons.png" class="icon-heart4">')
			.replaceAll('[M:H4]', '<img src="assets/icons.png" class="icon-heart5">')
			.replaceAll('[M:H5]', '<img src="assets/icons.png" class="icon-heart6">')
			.replaceAll('[M:H6]', '<img src="assets/icons.png" class="icon-heart7">')
			.replaceAll('[M:H7]', '<img src="assets/icons.png" class="icon-heart8">')
			.replaceAll('[M:H8]', '<img src="assets/icons.png" class="icon-heart9">')
			.replaceAll('[M:R0]', '<img src="assets/icons.png" class="icon-dash">')
			.replaceAll('[M:R1]', '<img src="assets/icons.png" class="icon-star2">')
			.replaceAll('[M:R2]', '<img src="assets/icons.png" class="icon-star3">')
			.replaceAll('[M:R3]', '<img src="assets/icons.png" class="icon-mail1">')
			.replaceAll('[M:R4]', '<img src="assets/icons.png" class="icon-mail2">')
			.replaceAll('[M:R5]', '<img src="assets/icons.png" class="icon-mail3">')
			.replaceAll('[M:R6]', '<img src="assets/icons.png" class="icon-mail4">')
			.replaceAll('[M:R7]', '<img src="assets/icons.png" class="icon-exclamation">')
			.replaceAll('[M:R8]', '<img src="assets/icons.png" class="icon-wifi">')
			.replaceAll('[M:R9]', '<img src="assets/icons.png" class="icon-email">')
			.replaceAll('[M:T0]', ':')
			.replaceAll('[M:T1]', ' ')
			.replaceAll('[M:T2]', '<img src="assets/icons.png" class="icon-bubble">')
			.replaceAll('[M:T3]', '<img src="assets/icons.png" class="icon-kanji1">')
			.replaceAll('[M:T4]', '<img src="assets/icons.png" class="icon-kanji2">')
			.replaceAll('[M:T5]', '<img src="assets/icons.png" class="icon-kanji3">')
			.replaceAll('[M:I0]', '<img src="assets/icons.png" class="icon-tm">')
			.replaceAll('[M:I1]', '<img src="assets/icons.png" class="icon-orb">')

			.replaceAll('[CS:A]', '<span class="color1">')
			.replaceAll('[CS:B]', '<span class="color2">')
			.replaceAll('[CS:C]', '<span class="color3">')
			.replaceAll('[CS:D]', '<span class="color4">')
			.replaceAll('[CS:E]', '<span class="color5">')
			.replaceAll('[CS:F]', '<span class="color3">')
			.replaceAll('[CS:G]', '<span class="color5">')
			.replaceAll('[CS:H]', '<span class="color6">')
			.replaceAll('[CS:I]', '<span class="color7">')
			.replaceAll('[CS:J]', '<span class="color8">')
			.replaceAll('[CS:K]', '<span class="color9">')
			.replaceAll('[CS:L]', '<span class="color10">')
			.replaceAll('[CS:M]', '<span class="color9">')
			.replaceAll('[CS:N]', '<span class="color5">')
			.replaceAll('[CS:O]', '<span class="color11">')
			.replaceAll('[CS:P]', '<span class="color12">')
			.replaceAll('[CS:Q]', '<span class="color13">')
			.replaceAll('[CS:R]', '<span class="color14">')
			.replaceAll('[CS:S]', '<span class="color15">')
			.replaceAll('[CS:T]', '<span class="color16">')
			.replaceAll('[CS:U]', '<span class="color3">')
			.replaceAll('[CS:V]', '<span class="color5">')
			.replaceAll('[CS:W]', '<span class="color2">')
			.replaceAll('[CS:X]', '<span class="color17">')
			.replaceAll('[CS:Y]', '<span class="color18">')
			.replaceAll('[CS:Z]', '<span class="color19">')
			.replaceAll('[CR]', '<span class="color4">')

			.replaceAll('[hero]', '<span class="hero">HITMONCHAN</span>')
			.replaceAll('[partner]', '<span class="partner">MARSHADOW</span>')
			.replaceAll('[team]', '<span class="team">wcwcwcwcw</span>')
			.replaceAll('[c_kind:PLAYER]', '<span class="hero">HITMONCHAN</span>')
			.replaceAll('[c_kind:ATTENDANT1]', '<span class="hero">HITMONCHAN</span>');

			if (tin.includes("[FT:1]")) {
				let ustop, ustart = tin.indexOf("[FT:1]")+6;
				if (tin.includes("[FT:0]")){
					ustop = tin.indexOf("[FT:0]");
				} else {
					ustop = tin.length;
				}
				
				for (var i = ustart; i < ustop; i++) {
  					if (isUpperCase(tin.charAt(i))){
						tin = replaceAt(tin,i,String.fromCharCode(tin.charCodeAt(i)+9333));
					  }
				}
			}

			let tout = tin
			.replaceAll('\\n', '<br>').replaceAll('\n', '<br>').replaceAll("\\'", "'")
			.replaceAll('\\"', '"').replaceAll('\\\\', '\\').replaceAll(/\[[^\]]*]/g,"")
			;
			
			output.innerHTML = tout;

			let param = [];
			param = tout.split("<br>");
			param = param.length;

			drawBox(param);
		}

		function scaleChange(newScale){

			scale = newScale;
			output.style.top = 10 + 7 * scale + "px";
			output.style.paddingLeft = 10 + 13 * newScale + "px";
			output.style.fontSize = 100 * newScale + "%";
			output.style.lineHeight = 13 * newScale + "px";

			box.height = 52 * scale;
			box.width = 240 * scale;
			inputChange();
		}

		function scaleIcons(){

			icons = output.getElementsByTagName("img");

			for (img in icons) {

				if ($img.style.scale != scale){

					img.style.scale = scale;
					img.style.margin-top;
				}
			}
		}

		function speakerChange(newSpeaker){

			if (!newSpeaker){
				speaker = "";
			} else if (newSpeaker == "icon") {
				speaker = '<img src="assets/icons.png" class="icon-bubble">:';
			} else {
				speaker = "[" + newSpeaker + "]: ";
			}

			inputChange();
		}

		function load(){

			boxtop.src = 'assets/boxtop.png';
			boxmid.src = 'assets/boxmid.png';
			boxbot.src = 'assets/boxbot.png';

			if (!text) text = '.Hey, write something here [M:B44]!\\nYou can change the speaker below!.';
			input.value = text.substr(1,text.length-2)
			setTimeout(inputChange,300);
			setTimeout(inputChange,2000);
		}

		function toogleTable(table){
			let tbody = table.parentElement.parentElement.parentElement.getElementsByTagName("tbody");
			tbody[0].hidden = !tbody[0].hidden;
		}

		function findGetParameter(parameterName) {

		let result = null, tmp = [];
		location.search.substr(1).split("&").forEach(function (item) {
			tmp = item.split("=");
			if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
		});
		return result;
		}

		//WS stuff

		let text = findGetParameter("text");
		let scale = findGetParameter("scale");
		let wsOn = findGetParameter("ws");
		let wsServer = findGetParameter("wsServer");

		let speaker = "";

		let wsText = document.getElementById('wsText');
		let input = document.getElementById('input');
		let output = document.getElementById('output');
		let canvas = document.getElementById('box');
		let context = canvas.getContext('2d');
		context.imageSmoothingEnabled = false;
		context.mozImageSmoothingEnabled = false;
		context.webkitImageSmoothingEnabled = false;
		let boxtop = new Image();
		let boxmid = new Image();
		let boxbot = new Image();

		if (!scale) scale = 1;
		scaleChange(scale);

		if (wsOn){

			document.getElementsByClassName("wsStatus")[0].hidden = false;
			

			if(!wsServer) wsServer="ws://localhost:45546";
			
			console.log("WS Server: " + wsServer);

			ws = new WebSocket(wsServer);

			ws.addEventListener("open", ()=> {
				wsText.innerText = "Connected!";
				console.log("Conected!");
			});

			ws.onerror=function(evnt){
				wsText.innerText = "Error! Try reloading the page";
 				console.log("Error during connection");
			}

			ws.onclose = function(evnt){
				if(evnt == 3001){
					wsText.innerText = "Closed";
					console.log("Closed succsesfully");
				} else {
					wsText.innerText = "Error! Try reloading the site";
					console.log("error: " + evnt.code);
				}
			}

			ws.addEventListener("message", data => {

				console.log(data);
				let event = JSON.parse(data.data).event;
				if (event == "debugger_selected_string_changed"){
					console.log(JSON.parse(data.data).args);
					input.value = JSON.parse(data.data).args;
					inputChange();
				} 
			});
		}

		load();
	</script>
</body>
</html>