<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
	<link rel="stylesheet" href="styles.css">
	<title>PMD Text Line Test</title>
	
	<link rel="icon" 
      type="image/png" 
      href="assets/favicon.png" />
	  
	<meta charset="utf-8"/>
	<meta name="description" content="Test Lines of text"/>
	<meta name="author" content="u/TheDasK" />
	<meta name="robots" content="index,nofollow" />
	  
</head>
<body>
	<h1>ExplorerScript Text Test</h1>
	<div class="section-input">
		<textarea rows="4" cols="56" id="input" onkeyup="inputChange()"></textarea>
	</div>
	<div class="section-result ">
		<canvas width="480" height="88" id="box" class="pixelated"></canvas>
		<p id="output"></p>
	</div>
	<div class="wsStatus" hidden>
		<img src="assets/skytemple.png"><p id="wsText">Connecting</p>
	</div>
	<div class="section-text">
		<p>Scale: <a onclick="scaleChange(1)">1x</a> <a onclick="scaleChange(2)">2x</a> <a onclick="scaleChange(3)">3x</a> <a onclick="scaleChange(4)">4x</a> </p>
		<p>Speaker: <a onclick="speakerChange('hero')">Hero</a> <a onclick="speakerChange('partner')">Partner</a> <a onclick="speakerChange('icon')">Icon</a> <a onclick="speakerChange('')">None</a></p>
		<p>Custom Speaker: <input id="input_name" onkeyup="speakerChange(1)"></input></p>
		<p>Icon rendering: <a onclick="changeRenderType(false)">Text</a> <a onclick="changeRenderType(true)">Images</a>
		<p>Welcome to the Explorerscript Text Test! The idea of the site is to test if lines of text written in ExplorerScript fits in a the game's text box.<br>
			All characters should have the right size, but let me know if I messed up any symbol! The textbox is multi-line so you can check as many lines as you want.<br>
			These special symbols are supported, with some modifications:
		   <ul>
			<li>\n &nbsp;→&nbsp; New Line</li>
			<li>\' &nbsp;→&nbsp; '</li>
			<li>\" &nbsp;→&nbsp; "</li>
			<li>~FF &nbsp;→&nbsp; Hex code</li>
		</ul>
		</p>
		<div class="tables">
			<table class="tagtables">
				<thead>
					<tr><th colspan="3" onclick="toogleTable(this)">Show Icon Tags</th></tr>
				</thead>
				<tbody hidden>
					<tr><td>Tag</td><td>Icon</td><td>Description</td></tr>
					<tr><td>[M:B0]</td><td><img src="assets/icons.png" class="icon-controls1"></td><td>Start</td></tr>
					<tr><td>[M:B1]</td><td><img src="assets/icons.png" class="icon-controls2"></td><td>Select</td></tr>
					<tr><td>[M:B2]</td><td><img src="assets/icons.png" class="icon-controls3"></td><td>A</td></tr>
					<tr><td>[M:B3]</td><td><img src="assets/icons.png" class="icon-controls4"></td><td>B</td></tr>
					<tr><td>[M:B4]</td><td><img src="assets/icons.png" class="icon-controls5"></td><td>X</td></tr>
					<tr><td>[M:B5]</td><td><img src="assets/icons.png" class="icon-controls6"></td><td>Y</td></tr>
					<tr><td>[M:B6]</td><td><img src="assets/icons.png" class="icon-controls7"></td><td>L</td></tr>
					<tr><td>[M:B7]</td><td><img src="assets/icons.png" class="icon-controls8"></td><td>R</td></tr>
					<tr><td>[M:B8]</td><td><img src="assets/icons.png" class="icon-controls9"></td><td>D-Pad</td></tr>
					<tr><td>[M:B9]</td><td><img src="assets/icons.png" class="icon-block1"></td><td>- Block</td></tr>
					<tr><td>[M:B10]</td><td><img src="assets/icons.png" class="icon-block2"></td><td>Check Block</td></tr>
					<tr><td>[M:B11]</td><td><img src="assets/icons.png" class="icon-block3"></td><td>X Block</td></tr>
					<tr><td>[M:B12]</td><td><img src="assets/icons.png" class="icon-block4"></td><td>Up Block</td></tr>
					<tr><td>[M:B13]</td><td><img src="assets/icons.png" class="icon-block5"></td><td>Down Block</td></tr>
					<tr><td>[M:B14]</td><td><img src="assets/icons.png" class="icon-block6"></td><td>Left Block</td></tr>
					<tr><td>[M:B15]</td><td><img src="assets/icons.png" class="icon-block7"></td><td>Right Block</td></tr>
					<tr><td>[M:B16]</td><td><img src="assets/icons.png" class="icon-block8"></td><td>Rewind Block</td></tr>
					<tr><td>[M:B17]</td><td><img src="assets/icons.png" class="icon-block9"></td><td>FF Block</td></tr>
					<tr><td>[M:B18]</td><td><img src="assets/icons.png" class="icon-block10"></td><td>Sort Block</td></tr>
					<tr><td>[M:B19]</td><td><img src="assets/icons.png" class="icon-block11"></td><td>Search Block</td></tr>
					<tr><td>[M:B20]</td><td><img src="assets/icons.png" class="icon-block12"></td><td>D-Pad U-D Block</td></tr>
					<tr><td>[M:B21]</td><td><img src="assets/icons.png" class="icon-block13"></td><td>D-Pad L-R Block</td></tr>
					<tr><td>[M:B22]</td><td><img src="assets/icons.png" class="icon-gblock1"></td><td>- Gold Block</td></tr>
					<tr><td>[M:B23]</td><td><img src="assets/icons.png" class="icon-gblock2"></td><td>Check Gold Block</td></tr>
					<tr><td>[M:B24]</td><td><img src="assets/icons.png" class="icon-gblock3"></td><td>X Gold Block</td></tr>
					<tr><td>[M:B25]</td><td><img src="assets/icons.png" class="icon-gblock4"></td><td>Up Gold Block</td></tr>
					<tr><td>[M:B26]</td><td><img src="assets/icons.png" class="icon-gblock5"></td><td>Down Gold Block</td></tr>
					<tr><td>[M:B27]</td><td><img src="assets/icons.png" class="icon-gblock6"></td><td>Left Gold Block</td></tr>
					<tr><td>[M:B28]</td><td><img src="assets/icons.png" class="icon-gblock7"></td><td>Right Gold Block</td></tr>
					<tr><td>[M:B29]</td><td><img src="assets/icons.png" class="icon-gblock8"></td><td>Rewind Gold Block</td></tr>
					<tr><td>[M:B30]</td><td><img src="assets/icons.png" class="icon-gblock11"></td><td>FF Gold Block</td></tr>
					<tr><td>[M:B31]</td><td><img src="assets/icons.png" class="icon-gblock12"></td><td>Sort Gold Block</td></tr>
					<tr><td>[M:B32]</td><td><img src="assets/icons.png" class="icon-gblock13"></td><td>Search Gold Block</td></tr>
					<tr><td>[M:S0]</td><td><img src="assets/icons.png" class="icon-pmoney"></td><td>P-Money</td></tr>
					<tr><td>[M:S1]</td><td> </td><td>Space</td></tr>
					<tr><td>[M:S2]</td><td><img src="assets/icons.png" class="icon-check1"></td><td>Check</td></tr>
					<tr><td>[M:S3]</td><td><img src="assets/icons.png" class="icon-star1"></td><td>Star</td></tr>
					<tr><td>[M:S4]</td><td><img src="assets/icons.png" class="icon-check2"></td><td>X</td></tr>
					<tr><td>[M:S5]</td><td><img src="assets/icons.png" class="icon-check3"></td><td>Check X</td></tr>
					<tr><td>[M:S6]</td><td><img src="assets/icons.png" class="icon-bag"></td><td>Bag</td></tr>
					<tr><td>[M:S7]</td><td><img src="assets/icons.png" class="icon-hut"></td><td>Hut</td></tr>
					<tr><td>[M:H0]</td><td><img src="assets/icons.png" class="icon-heart1"></td><td>Heart pink vsmall</td></tr>
					<tr><td>[M:H1]</td><td><img src="assets/icons.png" class="icon-heart2"></td><td>Heart pink small</td></tr>
					<tr><td>[M:H2]</td><td><img src="assets/icons.png" class="icon-heart3"></td><td>Heart pink</td></tr>
					<tr><td>[M:H3]</td><td><img src="assets/icons.png" class="icon-heart4"></td><td>Heart pink big</td></tr>
					<tr><td>[M:H4]</td><td><img src="assets/icons.png" class="icon-heart5"></td><td>Heart yellow vsmall</td></tr>
					<tr><td>[M:H5]</td><td><img src="assets/icons.png" class="icon-heart6"></td><td>Heart yellow small</td></tr>
					<tr><td>[M:H6]</td><td><img src="assets/icons.png" class="icon-heart7"></td><td>Heart yellow</td></tr>
					<tr><td>[M:H7]</td><td><img src="assets/icons.png" class="icon-heart8"></td><td>Heart yellow big</td></tr>
					<tr><td>[M:H8]</td><td><img src="assets/icons.png" class="icon-heart9"></td><td>Heart pink unshaded</td></tr>
					<tr><td>[M:R0]</td><td><img src="assets/icons.png" class="icon-dash"></td><td>Dash</td></tr>
					<tr><td>[M:R1]</td><td><img src="assets/icons.png" class="icon-star2"></td><td>Half Star</td></tr>
					<tr><td>[M:R2]</td><td><img src="assets/icons.png" class="icon-star3"></td><td>Amber Gem?</td></tr>
					<tr><td>[M:R3]</td><td><img src="assets/icons.png" class="icon-mail1"></td><td>Unopened Mail</td></tr>
					<tr><td>[M:R4]</td><td><img src="assets/icons.png" class="icon-mail2"></td><td>Open Mail</td></tr>
					<tr><td>[M:R5]</td><td><img src="assets/icons.png" class="icon-mail3"></td><td>Letter</td></tr>
					<tr><td>[M:R6]</td><td><img src="assets/icons.png" class="icon-mail4"></td><td>Newspaper</td></tr>
					<tr><td>[M:R7]</td><td><img src="assets/icons.png" class="icon-exclamation"></td><td>! Box</td></tr>
					<tr><td>[M:R8]</td><td><img src="assets/icons.png" class="icon-wifi"></td><td>Wi-Fi</td></tr>
					<tr><td>[M:R9]</td><td><img src="assets/icons.png" class="icon-email"></td><td>E-Mail</td></tr>
					<tr><td>[M:T0]</td><td>:</td><td>Colon</td></tr>
					<tr><td>[M:T1]</td><td><img src="assets/icons.png" class="icon-bubble"></td><td>Text Bubble</td></tr>
					<tr><td>[M:T2]</td><td><img src="assets/icons.png" class="icon-space1"></td><td>Space Indicator</td></tr>
					<tr><td>[M:T3]</td><td><img src="assets/icons.png" class="icon-space2"></td><td>Space Indicator Red</td></tr>
					<tr><td>[M:T4]</td><td><img src="assets/icons.png" class="icon-kanji1"></td><td>Kanji 'Kari' (temp)</td></tr>
					<tr><td>[M:T5]</td><td><img src="assets/icons.png" class="icon-kanji2"></td><td>Kanji 'Su' (end)</td></tr>
					<tr><td>[M:T6]</td><td><img src="assets/icons.png" class="icon-kanji3"></td><td>Katakana 'De'</td></tr>
					<tr><td>[M:I0]</td><td><img src="assets/icons.png" class="icon-tm"></td><td>TM</td></tr>
					<tr><td>[M:I1]</td><td><img src="assets/icons.png" class="icon-orb"></td><td>Orb</td></tr>
				</tbody>
			</table>
			<table class="tagtables">
				<thead>
					<tr><th colspan="2" onclick="toogleTable(this)">Show Color Tags</th></tr>
				</thead>
				<tbody id="hiddable" hidden>
					<tr><td>Tag</td><td>Color</td></tr>
					<tr><td>[CS:A]</td><td><span class="color1">Cream</td></tr>
					<tr><td>[CS:B]</td><td><span class="color2">Red</td></tr>
					<tr><td>[CS:C]</td><td><span class="color3">Yellow</td></tr>
					<tr><td>[CS:D]</td><td><span class="color4">White</td></tr>
					<tr><td>[CS:G]</td><td><span class="color5">Cyan</td></tr>
					<tr><td>[CS:H]</td><td><span class="color6">Pink</td></tr>
					<tr><td>[CS:J]</td><td><span class="color8">Light Yellow</td></tr>
					<tr><td>[CS:K]</td><td><span class="color9">Light Green</td></tr>
					<tr><td>[CS:L]</td><td><span class="color10">Green</td></tr>
					<tr><td>[CS:O]</td><td><span class="color11">Dark Green</td></tr>
					<tr><td>[CS:P]</td><td><span class="color12">Dark Cream</td></tr>
					<tr><td>[CS:Q]</td><td><span class="color13">Blue</td></tr>
					<tr><td>[CS:R]</td><td><span class="color14">Pale Green</td></tr>
					<tr><td>[CS:S]</td><td><span class="color15">Purple</td></tr>
					<tr><td>[CS:T]</td><td><span class="color16">Transparent</td></tr>
					<tr><td>[CS:X]</td><td><span class="color17">Bright Pink</td></tr>
					<tr><td>[CS:Y]</td><td><span class="color18">Light Blue</td></tr>
					<tr><td>[CS:Z]</td><td><span class="color19">Light Purple</td></tr>
					<tr><td>[CR]</td><td><span class="color4">End Coloring</td></tr>
				</tbody>
			</table>
			<table class="tagtables">
				<thead>
					<tr><th colspan="2" onclick="toogleTable(this)">Show Other Tags</th></tr>
				</thead>
				<tbody hidden>
					<tr><td>Tag</td><td>Color</td></tr>
					<tr><td>[hero]</td><td>Player Name</td></tr>
					<tr><td>[partner]</td><td>Partner Name</td></tr>
					<tr><td>[team]</td><td>Team Name</td></tr>
					<tr><td>[FT:1]</td><td>Start Unown text, uses Caps</td></tr>
					<tr><td>[FT:0]</td><td>Stop Unown text</td></tr>
					<tr><td>[c_kind:PLAYER]</td><td>Player Species</td></tr>
					<tr><td>[c_kind:ATTENDANT1]</td><td>Partner Species</td></tr>
					<tr><td>[CN]</td><td>Center following text TODO</td></tr>
					<tr><td>[S:#]</td><td>Adds a space of # pixels TODO</td></tr>
					<tr><td>[BAR]</td><td>Horizontal Line TODO</td></tr>
					<tr><td colspan="2">Beyond the scope of this tool:</td></tr>
					<tr><td>[K]</td><td>Waits for Player input</td></tr>
					<tr><td>[W:#]</td><td>Waits for # frames</td></tr>
					<tr><td>[C]</td><td>Pause at end</td></tr>
				</tbody>
			</table>
		</div>
		<p>Known inaccuracies:</p>
		<ul>
			<li>Invalid text within brackes (e.g. <samp>[Hello, world!]</samp>) will generally crash. Use <samp>~5B</samp> and <samp>~5D</samp> to produce brackets safely, and <samp>~7E</samp> to produce a tilde. </li>
			<li>Icons overflowing the end of a string will stack instead of breaking the line. Use (<samp>\n</samp>) to avoid undefined behavior.</li>
			<li>Unown text <samp>[FT:1]</samp> changes the offset of all ASCII characters. Any character except for capital letters is defined, but largely unexpected for actual use.</li>
		</ul>
		<p>This tool was originally developed by DasK on <a href="https://discord.gg/4e3X36f">SkyTemple's Discord</a>. The latest updates were made by Emblem (emblem.blend)<br>
		</p>
		<p>
		Check the sourcecode <a href="https://github.com/theDasK/TextTest">here</a>. <a href="https://www.dafont.com/wonder-mail.font">Wonder Mail</a> font by <a href="https://www.reddit.com/user/ShinxHijinx">ShinxHijinx</a>
		</p>
	</div>


	<script>
		const tags = {
			// Tag - Character - Image tag
			//     - 57344 = Hex E000
			"[M:B0]": [57344 + 0, '<img src="assets/icons/Start.png", class="icons">'],
			"[M:B1]": [57344 + 1, '<img src="assets/icons/Select.png", class="icons">'],
			"[M:B2]": [57344 + 2, '<img src="assets/icons/A.png", class="icons">'],
			"[M:B3]": [57344 + 3, '<img src="assets/icons/B.png", class="icons">'],
			"[M:B4]": [57344 + 4, '<img src="assets/icons/X.png", class="icons">'],
			"[M:B5]": [57344 + 5, '<img src="assets/icons/Y.png", class="icons">'],
			"[M:B6]": [57344 + 6, '<img src="assets/icons/L.png", class="icons">'],
			"[M:B7]": [57344 + 7, '<img src="assets/icons/R.png", class="icons">'],
			"[M:B8]": [57344 + 8, '<img src="assets/icons/D-pad.png", class="icons">'],
			"[M:B9]": [57344 + 9, '<img src="assets/icons/- Block.png", class="icons">'],
			"[M:B10]": [57344 + 10, '<img src="assets/icons/Check Block.png", class="icons">'],
			"[M:B11]": [57344 + 12, '<img src="assets/icons/X Block.png", class="icons">'],
			"[M:B12]": [57344 + 13, '<img src="assets/icons/Up Block.png", class="icons">'],
			"[M:B13]": [57344 + 14, '<img src="assets/icons/Down Block.png", class="icons">'],
			"[M:B14]": [57344 + 15, '<img src="assets/icons/Left Block.png", class="icons">'],
			"[M:B15]": [57344 + 16, '<img src="assets/icons/Right Block.png", class="icons">'],
			"[M:B16]": [57344 + 17, '<img src="assets/icons/Rewind Block.png", class="icons">'],
			"[M:B17]": [57344 + 18, '<img src="assets/icons/FF Block.png", class="icons">'],
			"[M:B18]": [57344 + 19, '<img src="assets/icons/Sort Block.png", class="icons">'],
			"[M:B19]": [57344 + 20, '<img src="assets/icons/Search Block.png", class="icons">'],
			"[M:B20]": [57344 + 8, '<img src="assets/icons/D-Pad Vertical.png", class="icons">'],
			"[M:B21]": [57344 + 8, '<img src="assets/icons/D-Pad Horizontal.png", class="icons">'],
			"[M:B22]": [57344 + 9, '<img src="assets/icons/Gold - Block.png", class="icons">'],
			"[M:B23]": [57344 + 10, '<img src="assets/icons/Gold Check Block.png", class="icons">'],
			"[M:B24]": [57344 + 12, '<img src="assets/icons/Gold X Block.png", class="icons">'],
			"[M:B25]": [57344 + 13, '<img src="assets/icons/Gold Up Block.png", class="icons">'],
			"[M:B26]": [57344 + 14, '<img src="assets/icons/Gold Down Block.png", class="icons">'],
			"[M:B27]": [57344 + 15, '<img src="assets/icons/Gold Left Block.png", class="icons">'],
			"[M:B28]": [57344 + 16, '<img src="assets/icons/Gold Right Block.png", class="icons">'],
			"[M:B29]": [57344 + 17, '<img src="assets/icons/Gold Rewind Block.png", class="icons">'],
			"[M:B30]": [57344 + 18, '<img src="assets/icons/Gold FF Block.png", class="icons">'],
			"[M:B31]": [57344 + 19, '<img src="assets/icons/Gold Sort Block.png", class="icons">'],
			"[M:B32]": [57344 + 20, '<img src="assets/icons/Gold Search Block.png", class="icons">'],
			
			
			"[M:B33]": [57344 + 21, '<img src="assets/icons/P-Money.png", class="icons">'],
			"[M:B34]": [32, '<img src="assets/icons/Space.png", class="icons">'],
			"[M:B35]": [57344 + 22, '<img src="assets/icons/Check.png", class="icons">'],
			"[M:B36]": [57344 + 25, '<img src="assets/icons/Star.png", class="icons">'],
			"[M:B37]": [57344 + 23, '<img src="assets/icons/X2.png", class="icons">'],
			"[M:B38]": [57344 + 24, '<img src="assets/icons/Check X.png", class="icons">'],
			"[M:B39]": [57344 + 27, '<img src="assets/icons/Bag.png", class="icons">'],
			"[M:B40]": [57344 + 28, '<img src="assets/icons/Hut.png", class="icons">'],
			"[M:B41]": [57344 + 29, '<img src="assets/icons/Tiny Pink Heart.png", class="icons">'],
			"[M:B42]": [57344 + 30, '<img src="assets/icons/Small Pink Heart.png", class="icons">'],
			"[M:B43]": [57344 + 31, '<img src="assets/icons/Pink Heart.png", class="icons">'],
			"[M:B44]": [57344 + 32, '<img src="assets/icons/Large Pink Heart.png", class="icons">'],
			"[M:B45]": [57344 + 29, '<img src="assets/icons/Tiny Gold Heart.png", class="icons">'],
			"[M:B46]": [57344 + 30, '<img src="assets/icons/Small Gold Heart.png", class="icons">'],
			"[M:B47]": [57344 + 31, '<img src="assets/icons/Gold Heart.png", class="icons">'],
			"[M:B48]": [57344 + 32, '<img src="assets/icons/Large Gold Heart.png", class="icons">'],
			"[M:B49]": [57344 + 31, '<img src="assets/icons/Unshaded Heart.png", class="icons">'],
			"[M:B50]": [57344 + 33, '<img src="assets/icons/Dash.png", class="icons">'],
			"[M:B51]": [57344 + 26, '<img src="assets/icons/Half Star.png", class="icons">'],
			"[M:B52]": [57344 + 34, '<img src="assets/icons/Amber Gem.png", class="icons">'],
			"[M:B53]": [57344 + 35, '<img src="assets/icons/Mail.png", class="icons">'],
			"[M:B54]": [57344 + 36, '<img src="assets/icons/Open Mail.png", class="icons">'],
			"[M:B55]": [57344 + 37, '<img src="assets/icons/Letter.png", class="icons">'],
			"[M:B56]": [57344 + 38, '<img src="assets/icons/Newspaper.png", class="icons">'],
			"[M:B57]": [57344 + 39, '<img src="assets/icons/Exclamation Box.png", class="icons">'],
			"[M:B58]": [57344 + 40, '<img src="assets/icons/Wi-Fi.png", class="icons">'],
			"[M:B59]": [57344 + 42, '<img src="assets/icons/E-Mail.png", class="icons">'],
			"[M:B60]": [58, '<img src="assets/icons/Colon.png", class="icons">'],
			"[M:B61]": [57344 + 41, '<img src="assets/icons/Text Bubble.png", class="icons">'],
			"[M:B62]": [9251, '<img src="assets/icons/Space Indicator.png", class="icons">'],
			"[M:B63]": [9251, '<img src="assets/icons/Space Indicator Red.png", class="icons">'],
			"[M:B64]": [57344 + 50, '<img src="assets/icons/Kari.png", class="icons">'],
			"[M:B65]": [57344 + 51, '<img src="assets/icons/Su.png", class="icons">'],
			"[M:B66]": [57344 + 52, '<img src="assets/icons/De.png", class="icons">'],
			"[M:B67]": [57344 + 43, '<img src="assets/icons/TM.png", class="icons">'],
			"[M:B68]": [57344 + 44, '<img src="assets/icons/Orb.png", class="icons">'],
			
			
			"[M:S0]": [57344 + 21, '<img src="assets/icons/P-Money.png", class="icons">'],
			"[M:S1]": [32, '<img src="assets/icons/Space.png", class="icons">'],
			"[M:S2]": [57344 + 22, '<img src="assets/icons/Check.png", class="icons">'],
			"[M:S3]": [57344 + 25, '<img src="assets/icons/Star.png", class="icons">'],
			"[M:S4]": [57344 + 23, '<img src="assets/icons/X2.png", class="icons">'],
			"[M:S5]": [57344 + 24, '<img src="assets/icons/Check X.png", class="icons">'],
			"[M:S6]": [57344 + 27, '<img src="assets/icons/Bag.png", class="icons">'],
			"[M:S7]": [57344 + 28, '<img src="assets/icons/Hut.png", class="icons">'],
			
			"[M:H0]": [57344 + 29, '<img src="assets/icons/Tiny Pink Heart.png", class="icons">'],
			"[M:H1]": [57344 + 30, '<img src="assets/icons/Small Pink Heart.png", class="icons">'],
			"[M:H2]": [57344 + 31, '<img src="assets/icons/Pink Heart.png", class="icons">'],
			"[M:H3]": [57344 + 32, '<img src="assets/icons/Large Pink Heart.png", class="icons">'],
			"[M:H4]": [57344 + 29, '<img src="assets/icons/Tiny Gold Heart.png", class="icons">'],
			"[M:H5]": [57344 + 30, '<img src="assets/icons/Small Gold Heart.png", class="icons">'],
			"[M:H6]": [57344 + 31, '<img src="assets/icons/Gold Heart.png", class="icons">'],
			"[M:H7]": [57344 + 32, '<img src="assets/icons/Large Gold Heart.png", class="icons">'],
			"[M:H8]": [57344 + 31, '<img src="assets/icons/Unshaded Heart.png", class="icons">'],
			"[M:R0]": [57344 + 33, '<img src="assets/icons/Dash.png", class="icons">'],
			"[M:R1]": [57344 + 26, '<img src="assets/icons/Half Star.png", class="icons">'],
			"[M:R2]": [57344 + 34, '<img src="assets/icons/Amber Gem.png", class="icons">'],
			"[M:R3]": [57344 + 35, '<img src="assets/icons/Mail.png", class="icons">'],
			"[M:R4]": [57344 + 36, '<img src="assets/icons/Open Mail.png", class="icons">'],
			"[M:R5]": [57344 + 37, '<img src="assets/icons/Letter.png", class="icons">'],
			"[M:R6]": [57344 + 38, '<img src="assets/icons/Newspaper.png", class="icons">'],
			"[M:R7]": [57344 + 39, '<img src="assets/icons/Exclamation Box.png", class="icons">'],
			"[M:R8]": [57344 + 40, '<img src="assets/icons/Wi-Fi.png", class="icons">'],
			"[M:R9]": [57344 + 42, '<img src="assets/icons/E-Mail.png", class="icons">'],
			
			"[M:T0]": [58, '<img src="assets/icons/Colon.png", class="icons">'],
			"[M:T1]": [57344 + 41, '<img src="assets/icons/Text Bubble.png", class="icons">'],
			"[M:T2]": [9251, '<img src="assets/icons/Space Indicator.png", class="icons">'],
			"[M:T3]": [9251, '<img src="assets/icons/Space Indicator Red.png", class="icons">'],
			"[M:T4]": [57344 + 50, '<img src="assets/icons/Kari.png", class="icons">'],
			"[M:T5]": [57344 + 51, '<img src="assets/icons/Su.png", class="icons">'],
			"[M:T6]": [57344 + 52, '<img src="assets/icons/De.png", class="icons">'],
			
			"[M:I0]": [57344 + 43, '<img src="assets/icons/TM.png", class="icons">'],
			"[M:I1]": [57344 + 44, '<img src="assets/icons/Orb.png", class="icons">'],
					
			"[CS:A]": [58112 + 1, String.fromCharCode(58113)], // Color codes evaluated last
			"[CS:B]": [58112 + 2, String.fromCharCode(58114)],
			"[CS:C]": [58112 + 3, String.fromCharCode(58115)],
			"[CS:D]": [58112 + 4, String.fromCharCode(58116)],
			"[CS:E]": [58112 + 5, String.fromCharCode(58117)],
			"[CS:F]": [58112 + 6, String.fromCharCode(58118)],
			"[CS:G]": [58112 + 7, String.fromCharCode(58119)],
			"[CS:H]": [58112 + 8, String.fromCharCode(58120)],
			"[CS:I]": [58112 + 9, String.fromCharCode(58121)],
			"[CS:J]": [58112 + 10, String.fromCharCode(58122)],
			"[CS:K]": [58112 + 11, String.fromCharCode(58123)],
			"[CS:L]": [58112 + 12, String.fromCharCode(58124)],
			"[CS:M]": [58112 + 13, String.fromCharCode(58125)],
			"[CS:N]": [58112 + 14, String.fromCharCode(58126)],
			"[CS:O]": [58112 + 15, String.fromCharCode(58127)],
			"[CS:P]": [58112 + 16, String.fromCharCode(58128)],
			"[CS:Q]": [58112 + 17, String.fromCharCode(58129)],
			"[CS:R]": [58112 + 18, String.fromCharCode(58130)],
			"[CS:S]": [58112 + 19, String.fromCharCode(58131)],
			"[CS:T]": [58112 + 20, String.fromCharCode(58132)],
			"[CS:U]": [58112 + 21, String.fromCharCode(58133)],
			"[CS:V]": [58112 + 22, String.fromCharCode(58134)],
			"[CS:W]": [58112 + 23, String.fromCharCode(58135)],
			"[CS:X]": [58112 + 24, String.fromCharCode(58136)],
			"[CS:Y]": [58112 + 25, String.fromCharCode(58137)],
			"[CS:Z]": [58112 + 26, String.fromCharCode(58138)],
			"[CR]"  : [58112 + 0 , String.fromCharCode(58112)],
			
			
			"[FT:0]": [58112 + 50, String.fromCharCode(58162)],
			"[FT:1]": [58112 + 51, String.fromCharCode(58163)]
			
		};
		const characterTags = {
			"[hero]":				String.fromCharCode(58129) + "HITMONCHAN" + String.fromCharCode(58139),
			"[partner]":			String.fromCharCode(58115) + "MARSHADOW" + String.fromCharCode(58139),
			"[team]":    			String.fromCharCode(58136) + "wcwcwcwcw" + String.fromCharCode(58139),
			"[c_kind:PLAYER]": 		String.fromCharCode(58123) + "HITMONCHAN" + String.fromCharCode(58139),
			"[c_kind:ATTENDANT1]":	String.fromCharCode(58123) + "HITMONCHAN" + String.fromCharCode(58139)
		};
		
		const colorLookup = {
			58113: '<span class="color1">',
			58114: '<span class="color2">',
			58115: '<span class="color3">',
			58116: '<span class="color4">',
			58117: '<span class="color5">',
			58118: '<span class="color3">',
			58119: '<span class="color5">',
			58120: '<span class="color6">',
			58121: '<span class="color7">',
			58122: '<span class="color8">',
			58123: '<span class="color9">',
			58124: '<span class="color10">',
			58125: '<span class="color9">',
			58126: '<span class="color5">',
			58127: '<span class="color11">',
			58128: '<span class="color12">',
			58129: '<span class="color13">',
			58130: '<span class="color14">',
			58131: '<span class="color15">',
			58132: '<span class="color16">',
			58133: '<span class="color3">',
			58134: '<span class="color5">',
			58135: '<span class="color2">',
			58136: '<span class="color17">',
			58137: '<span class="color18">',
			58138: '<span class="color19">',
			58112: '<span class="color4">',
			58139: 'Reset' // Rolls back to previous color. Used for the Character tags.
		};
			
		function drawBox(nlines){
			
			canvas.height = 44*scale;
			output.height = 34*scale+20;
			context.clearRect(0, 0, canvas.width, canvas.height);

			if (nlines < 3) {
				canvas.height = 44*scale;
				context.drawImage(boxtop,0,0,240*scale,9*scale);
				context.drawImage(boxmid,0,9*scale,240*scale,26*scale);
				context.drawImage(boxbot,0,35*scale,240*scale,9*scale);
			} else {
				canvas.height = (18+13*nlines)*scale;
				context.drawImage(boxtop,0,0*scale,240*scale,9*scale);
				context.drawImage(boxmid,0,9*scale,240*scale,26*nlines*scale);
				context.drawImage(boxbot,0,(9+13*nlines)*scale,240*scale,9*scale);
			}
		}

		const isUpperCase = (string) => /^[A-Z]*$/.test(string)

		function replaceAt(str, index, replacement) {
    		return str.substr(0, index) + replacement + str.substr(index + replacement.length);
		}
		
		
		
		
		function inputChange() {
		
			let tin = speaker + input.value;
			charList = [];
			for (i=0; i<tin.length; i++) {
			
				// Parse characters left to right.
				c = tin.charAt(i)
				
				if (c=='[') { // Catches anything in brackets.
				
					searching = true;
					rbracket = i;
					while (searching) {
						rbracket++;
						if ((tin.charAt(rbracket) == ']') || (rbracket > tin.length)) {searching = false;}
					}
					tag = tin.substring(i, rbracket+1);
					
					if (tag in tags) {
						if (imgbased) {// True for inline HTML, false for characters for Canvas control (TODO)
							charList.push(tags[tag][1]);
						} else {
							cn = tags[tag][0];
							if (cn == 32) {
								charList.push('&nbsp&nbsp'); // Space tag
							} else {
								charList.push(String.fromCharCode(cn));
							}
						} 
					
					} else if (tag in characterTags) {
						charList = charList.concat(characterTags[tag].split(''))
					}
					i=rbracket;
				
				} else if (c=='\\') { // This is one backslash. TODO: go back and make sure we didn't miss functionality.
					ex = tin.charAt(i+1)
					
					if (ex == 'n') {
						charList.push('<br>');
						i++;
					} else if (ex == '"' || ex == "'") {
						charList.push(ex);
						i++;
					} else {
						charList.push(c);
					}
				} else if (c=='\n') {
					charList.push('<br>');
				} else if (c=='~') { // This eats any characters, but only produces valid output on two hex characters.
					usub = tin.substring(i+1, i+3);
					if (usub.search(/[0-9a-fA-F]{2}/)!=-1) { // Add more conditions for squares (hex 00-1f?)
						charList.push(String.fromCharCode(parseInt(usub,16)));
					} else {
						charList.push(String.fromCharCode(57400));
					}
					i=i+2
				} else if (c==' ') {
					charList.push('&nbsp');
				} else {
					charList.push(tin.charAt(i));
				}
				
			}
			
			
			
			
			// Post-processing - Unown text Unown-ifies Tilde text and names!
			let unToggle = false;
			
			for (let i=0; i<charList.length; i++) {
			console.log(unToggle);
				tag = charList[i];
				if (tag == String.fromCharCode(58163)) { // Begin Unowns character
					console.log("Beginning at "+i)
					charList.splice(i,1);
					unToggle = true;
					i--;
				} else if (tag == String.fromCharCode(58162)) { // End Unowns character
					console.log("Ending at "+i);
					charList.splice(i,1);
					unToggle = false;
					i--;
				} else {
					if (isUpperCase(tag) && unToggle) {
						tag = String.fromCharCode(tag.charCodeAt(0)+9333);
						charList[i] = tag;
					}
				}
			}
		
		
			let lastColor = [58116];
			
			for (let i=0; i<charList.length; i++) {
				tag = charList[i].charCodeAt(0);
				if (tag in colorLookup) {
					colortag = colorLookup[tag];
					if (colortag == "Reset") {
						lastColor.pop(tag);
					} else {
						lastColor.push(tag);
					}
					charList[i] = colorLookup[lastColor[lastColor.length-1]];
				}
				
			}
			
			let tout = charList.join("");
			output.innerHTML = tout;

			let param = [];
			param = tout.split("<br>");
			param = param.length;
			drawBox(param);
			scaleIcons();
		
		}
		

		function scaleChange(newScale){

			scale = newScale;
			output.style.top = 10 + 7 * scale + "px";
			output.style.paddingLeft = 10 + 13 * newScale + "px";
			output.style.fontSize = 100 * newScale + "%";
			output.style.lineHeight = 13 * newScale + "px";

			box.height = 52 * scale;
			box.width = 240 * scale;
			inputChange();
		}

		function scaleIcons(){
		
			icons = output.getElementsByClassName("icons");
			for (i = 0; i < icons.length; i++) {
				img = icons.item(i);
				img.width = img.width*scale;
			}
		}

		function speakerChange(newSpeaker){

			if (!newSpeaker){
				speaker = "";
			} else if (newSpeaker == "icon") {
				speaker = '[M:T1]';
			} else if (newSpeaker === 1) { // Custom speaker from textbox.
				speaker = '[CS:G]' + document.getElementById('input_name').value + "[CR]:";
				console.log("Newspeaker 1")
		    } else { // Hero or Partner.
				speaker = "[" + newSpeaker + "]:"; 
			}

			inputChange();
		}

		function load(){

			boxtop.src = 'assets/boxtop.png';
			boxmid.src = 'assets/boxmid.png';
			boxbot.src = 'assets/boxbot.png';

			if (!text) text = 'Hey, write something here [M:B44]!\\nYou can change the speaker below!';
			
			input.value = text.substr(0,text.length)
			setTimeout(inputChange,300);
			setTimeout(inputChange,2000);
		}

		function toogleTable(table){
			let tbody = table.parentElement.parentElement.parentElement.getElementsByTagName("tbody");
			tbody[0].hidden = !tbody[0].hidden;
		}

		function findGetParameter(parameterName) {

		let result = null, tmp = [];
		location.search.substr(1).split("&").forEach(function (item) {
			tmp = item.split("=");
			if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
		});
		return result;
		}
		
		function changeRenderType(PAIN) {
			imgbased = PAIN;
			inputChange();
		}
		
		let imgbased = true; // False uses text-based icons, true uses images

		//WS stuff

		let text = findGetParameter("text");
		let scale = findGetParameter("scale");
		let wsOn = findGetParameter("ws");
		let wsServer = findGetParameter("wsServer");

		let speaker = "";

		let wsText = document.getElementById('wsText');
		let input = document.getElementById('input');
		let output = document.getElementById('output');
		let canvas = document.getElementById('box');
		let context = canvas.getContext('2d');
		context.imageSmoothingEnabled = false;
		context.mozImageSmoothingEnabled = false;
		context.webkitImageSmoothingEnabled = false;
		let boxtop = new Image();
		let boxmid = new Image();
		let boxbot = new Image();

		if (!scale) scale = 1;
		scaleChange(scale);
		
		if (wsOn){

			//document.getElementsByClassName("wsStatus")[0].hidden = false;
			

			if(!wsServer) wsServer="ws://localhost:45546";
			
			console.log("WS Server: " + wsServer);

			ws = new WebSocket(wsServer);

			ws.addEventListener("open", ()=> {
				wsText.innerText = "Connected!";
				console.log("Conected!");
			});

			ws.onerror=function(evnt){
				wsText.innerText = "Error! Try reloading the page";
 				console.log("Error during connection");
			}

			ws.onclose = function(evnt){
				if(evnt == 3001){
					wsText.innerText = "Closed";
					console.log("Closed succsesfully");
				} else {
					wsText.innerText = "Error! Try reloading the site";
					console.log("error: " + evnt.code);
				}
			}

			ws.addEventListener("message", data => {

				console.log(data);
				let event = JSON.parse(data.data).event;
				if (event == "debugger_selected_string_changed"){
					console.log(JSON.parse(data.data).args);
					input.value = JSON.parse(data.data).args;
					inputChange();
				} 
			});
		}

		load();
	</script>
</body>
</html>
