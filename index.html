<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
	<link rel="stylesheet" href="styles.css">
	<title>PMD Text Line Test</title>
	
	<link rel="icon" 
      type="image/png" 
      href="assets/favicon.png" />
	  
	<meta charset="utf-8"/>
	<meta name="description" content="Test Lines of text"/>
	<meta name="author" content="u/TheDasK" />
	<meta name="robots" content="index,nofollow" />
	  
</head>
<body>
	<h1>ExplorerScript Boundary Test</h1>
	<div class="section">
		<textarea rows="4" cols="50" id="input" onkeyup="inputChange()"></textarea>
	</div>
	<div class="section">
		<canvas value="test text" width="480" height="106" id="box"></canvas>
		<p id="output"></p>
	</div>
	<div class="section-text">
		<p>Welcome to the Explorerscript Boundary Test! The idea of the site is to test if lines of text written in ExplorerScript fits in a the game's text box.<br>
			All characters should have the right size, but let me know if I messed up any symbol! The textbox is multi-line so you can check as many lines as you want.<br>
			These special symbols are supported, with some modifications:
		   <ul class="social-media">
			<li>\n - New Line</li>
			<li>\' - '</li>
			<li>\" - "</li>
			<li>[hero] [partner] [CS:X] - Displays "wcwcwcwcw" that should be the max allowed size for a name</li>
		</ul>
		Everything else in brackets gets ignored. If I missed some useful and common tag of symbol, or you want some other feature implemented,
		or just want to correct me on my grammar (please do), let me know, I'm DasK on <a href="https://discord.gg/4e3X36f">SkyTemple's Discord</a>!<br>
		</p>
		<p>
		Check the sourcecode <a href="https://github.com/theDasK/TextTest">here</a>. <a href="https://www.dafont.com/wonder-mail.font">Wonder Mail</a> font by <a href="https://www.reddit.com/user/ShinxHijinx">ShinxHijinx</a>
		</p>
	</div>


	<script>

		function drawBox(nlines){

			canvas.height = 52*scale;
			output.height = 34*scale+20;
			context.clearRect(0, 0, canvas.width, canvas.height);

			if (nlines < 3) {
				canvas.height = 52*scale;
				context.drawImage(boxtop,0,0,240*scale,9*scale);
				context.drawImage(boxmid,0,9*scale,240*scale,34*scale);
				context.drawImage(boxbot,0,43*scale,240*scale,9*scale);
			} else {
				canvas.height = (18+17*nlines)*scale;
				context.drawImage(boxtop,0,0*scale,240*scale,9*scale);
				context.drawImage(boxmid,0,9*scale,240*scale,34*nlines*scale);
				context.drawImage(boxbot,0,(9+17*nlines)*scale,240*scale,9*scale);
			}
		}

		function inputChange(){

			let tin = input.value;

			let tout = tin.replaceAll('\\b', '<i class="bouble></i>').replaceAll('\\p', '<i class="money></i>')
			.replaceAll('[hero]', 'wcwcwcwcw').replaceAll('[partner]', 'wcwcwcwcw').replaceAll('[CS:X]', 'wcwcwcwcw')
			.replaceAll('\\n', '\n').replaceAll(/\[[^\]]*]/g,"");

			output.innerText = tout;

			let param = [];
			param = tout.split("\n");
			param = param.length;

			drawBox(param);
		}

		function load(){

			boxtop.src = 'assets/boxtop.png';
			boxmid.src = 'assets/boxmid.png';
			boxbot.src = 'assets/boxbot.png';
			input.value = 'Hey, write something here!';
			setTimeout(inputChange,300);
		}

		let input = document.getElementById('input');
		let output = document.getElementById('output');
		let canvas = document.getElementById('box');
		let context = canvas.getContext('2d');
		context.imageSmoothingEnabled = false;
		let boxtop = new Image();
		let boxmid = new Image();
		let boxbot = new Image();

		let scale = 2;
		let paddx = 12 * scale, paddy = 9 * scale, sepy = 17 * scale;

		load();
	</script>
</body>
</html>